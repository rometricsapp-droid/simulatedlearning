<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Refer a Friend - RoMetrics</title>
    
    <link rel="icon" type="image/png" href="favicon-192.png">

    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        .logo { width: 150px; cursor: pointer; margin-bottom: 20px; }
        .container { max-width: 400px; margin: auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; }
        input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #1a73e8; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <a href="index.html">
        <img src="rometrics-logo.png" alt="RoMetrics Logo" class="logo">
    </a>

    <div class="container">
        <h2>Refer & Earn</h2>
        <p>Both of you get 1 month free when your friend signs up!</p>
        
        <input type="email" id="referrerEmail" placeholder="Your Email Address" required>
        
        <input type="email" id="friendEmail" placeholder="Friend's Email Address" required>
        
        <button onclick="submitReferral()">Submit for validation</button>
        <div id="status"></div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { projectId: "rometricsapp-1444e" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.submitReferral = async () => {
        const referrer = document.getElementById('referrerEmail').value;
        const friend = document.getElementById('friendEmail').value;
        const status = document.getElementById('status');

        if(!referrer || !friend) return alert("Both emails are required!");

        try {
            // Adds both emails to the 'users' collection for the Cloud Function to process
            await addDoc(collection(db, "users"), {
                referrer_email: referrer,
                email: friend, // Referred user
                status: "pending",
                created_at: serverTimestamp()
            });
            status.innerHTML = "<p style='color:green'>Success! Emails sent.</p>";
        } catch (e) {
            status.innerHTML = "<p style='color:red'>Error: " + e.message + "</p>";
        }
    };
</script>
</body>
</html>

