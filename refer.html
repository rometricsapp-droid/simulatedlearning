<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoMetrics Referral System</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        h1 { color: #1a73e8; font-size: 24px; }
        p { color: #5f6368; font-size: 14px; margin-bottom: 1.5rem; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #dadce0; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background-color: #1a73e8; color: white; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        button:hover { background-color: #1557b0; }
        #message { margin-top: 15px; font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>RoMetrics Referrals</h1>
    <p>Enter your friend's email to give them a free month and earn one for yourself!</p>
    
    <input type="email" id="friendEmail" placeholder="Friend's Email Address" required>
    <button onclick="submitReferral()">Send Invitation</button>
    
    <div id="message"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Your Firebase configuration based on serviceAccount.json 
  const firebaseConfig = {
    projectId: "rometricsapp-1444e",
    authDomain: "rometricsapp-1444e.firebaseapp.com",
    storageBucket: "rometricsapp-1444e.appspot.com",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.submitReferral = async () => {
    const friendEmail = document.getElementById('friendEmail').value;
    const messageDiv = document.getElementById('message');

    if (!friendEmail) {
        messageDiv.innerText = "Please enter an email.";
        messageDiv.style.color = "red";
        return;
    }

    try {
        // This triggers the Cloud Function logic we prepared
        // It creates a document in the 'users' collection which the function watches 
        await addDoc(collection(db, "users"), {
            email: friendEmail,
            referred_by_uid: "current_user_id_here", // This will be linked to the logged-in user
            status: "pending",
            created_at: serverTimestamp()
        });

        messageDiv.innerText = "Success! Once they register, you both get a code.";
        messageDiv.style.color = "green";
        document.getElementById('friendEmail').value = "";
    } catch (error) {
        messageDiv.innerText = "Error: " + error.message;
        messageDiv.style.color = "red";
    }
  };
</script>

</body>
</html>
